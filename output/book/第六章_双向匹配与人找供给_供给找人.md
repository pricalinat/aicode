# 第六章：双向匹配与人找供给/供给找人

## 6.1 引言

供给理解的最终目标是实现供给与需求的高效匹配。在数字平台中，匹配呈现出两种基本形态：用户主动寻找供给的“人找供给”模式，以及平台主动推送供给的“供给找人”模式。这两种模式分别对应着搜索和推荐两大核心场景，共同构成了供给与需求双向匹配的完整体系。本章将系统性地介绍双向匹配的技术体系，包括搜索匹配、推荐匹配、语义匹配、排序优化等核心内容，以及如何实现人找供给与供给找人的协同。

双向匹配的核心挑战在于如何准确理解供需双方的意图，并建立有效的匹配机制。在“人找供给”场景中，系统需要理解用户的查询意图和需求偏好；在“供给找人”场景中，系统需要理解供给的特点和目标用户群体。双向匹配不仅需要分别优化两个方向的匹配效果，还需要考虑全局的匹配效率和用户体验。

## 6.2 人找供给：搜索匹配

### 6.2.1 搜索匹配的技术框架

搜索匹配（Search Matching）是“人找供给”场景的核心技术，当用户在平台搜索商品或服务时，系统需要从海量供给中快速检索出最相关的结果。搜索匹配的技术框架通常包括以下几个关键环节：

**查询理解**是搜索匹配的第一步，负责解析用户的查询意图。查询理解包括查询分词、查询改写、查询扩展、意图识别等子任务。高质量的查询理解能够准确把握用户的真实需求，为后续的检索和排序提供基础。

**召回**是从海量供给中快速检索出一批候选结果的过程。由于供给数量庞大，召回阶段需要在保证相关性的同时注重召回效率。倒排索引、向量检索、图检索等技术是召回环节的常用方法。

**粗排**对召回的候选结果进行快速的初步排序，筛选出进入精排阶段的候选集。粗排模型通常采用轻量级的模型，以保证处理速度。

**精排**对粗排候选集进行精细的排序，综合考虑相关性、质量、商业价值等多个维度，输出最终的排序结果。精排模型通常采用复杂的深度学习模型，以最大化排序效果。

**重排**在精排的基础上进行全局优化，考虑多样性、新颖性、热门商品保护等全局目标，生成最终的展示列表。

### 6.2.2 语义匹配技术

传统的搜索匹配主要依赖关键词匹配，即在供给的标题、描述等文本中查找查询中包含的关键词。这种方法简单直接，但难以处理同义词、多义词、语义相似等复杂情况。语义匹配技术的发展使得系统能够理解查询和供给的深层语义，实现更加精准的匹配。

**基于表示的语义匹配**通过将查询和供给分别编码为向量表示，计算向量之间的相似度来判断语义相关性。这种方法的核心是学习有效的语义表示。BERT等预训练语言模型能够生成高质量的语义表示，在语义匹配任务上取得了显著效果。研究表明，经过微调的BERT模型在商品搜索语义匹配任务上的效果远超传统方法（Lu et al., 2020）。

> **批判性分析：** 语义匹配技术虽然取得了显著进展，但在实际应用中仍面临挑战。ColdRAG研究（2025）表明，传统基于交互数据的方法在新商品冷启动场景中表现不佳，其在Office数据集上的Recall@10提升达到123.81%，说明冷启动问题仍然是推荐系统的核心挑战。此外，ChatGPT作为推荐系统的研究（2601.01997）发现，LLM在推荐多样性方面与专门的协同过滤方法相比仍有差距，GPT-4在MovieLens数据集上的Gini指数为0.1050，低于ItemKNN等方法。

**知识图谱推荐**利用知识图谱中的结构化知识来增强推荐效果。知识图谱可以提供供给之间的语义关联、用户的历史偏好与供给属性之间的匹配等信息，帮助推荐系统做出更加准确和可解释的推荐。KGAT、KGIN等知识图谱注意力网络在推荐任务上取得了显著效果。

**基于交互的语义匹配**不直接计算查询和供给的向量相似度，而是先让查询和供给进行交互，捕获它们之间的局部相关性，再进行匹配预测。这种方法能够更好地捕捉查询和供给之间的细粒度匹配关系。ESIM、ABCNN等模型是基于交互的语义匹配的经典架构。

### 6.2.3 排序优化技术

排序优化是搜索匹配的核心环节，直接决定了用户看到的搜索结果的质量。排序优化需要综合考虑多个优化目标：

**相关性**是最基础的排序目标，确保搜索结果与用户查询相关。相关性可以通过文本相关性、语义相关性、点击反馈等多个维度来衡量。

**质量**是排序的重要考量，高质量的供给应该获得更好的排名。商品的质量可以通过评分、销量、好评率等指标来衡量；服务的质量可以通过用户评价、服务响应速度等指标来衡量。

**多样性**要求搜索结果呈现一定的多样性，避免结果过于同质化。多样性的排序可以通过 MMR（Diverse Maximal Marginal Relevance）等算法来实现。

**新鲜度**要求搜索结果具有一定的时效性，新上线的商品或服务应该有一定的曝光机会。新鲜度的排序可以通过发布时间、更新时间等指标来衡量。

深度学习排序模型是当前排序优化的主流方法。Deep & Cross Network（DCN）、DeepFM、xDeepFM等模型能够有效建模特征之间的交互，在搜索排序任务上取得了优异的效果。这些模型通过深度神经网络自动学习特征的高阶交互，减少了人工特征工程的工作量。

## 6.3 供给找人：推荐匹配

### 6.3.1 推荐匹配的技术框架

推荐匹配（Recommendation Matching）是“供给找人”场景的核心技术，当用户没有明确表达需求时，平台需要主动发现并推送可能满足用户需求的供给。推荐匹配的技术框架通常包括以下几个环节：

**用户理解**是推荐系统的基础，负责构建用户的兴趣画像。用户理解包括用户属性建模、行为序列建模、兴趣偏好挖掘等任务。通过分析用户的历史行为、用户画像、社交关系等数据，系统可以推断用户的兴趣偏好。

**供给理解**为推荐系统提供供给的特征表示。除了基础的内容特征外，供给理解还需要提取供给的复杂语义特征、供给之间的关联关系等。

**召回**从海量供给中快速筛选出用户可能感兴趣的候选集。召回策略包括热门召回、相似召回、协同过滤召回、向量召回等多种方法。

**粗排**对召回的候选进行初步排序，控制进入精排的候选数量。粗排需要在效果和效率之间取得平衡。

**精排**对候选供给进行精细的个性化排序，预测用户对每个供给的偏好程度。精排模型通常采用深度学习模型，如Wide & Deep、DeepFM等。

**重排**进行全局优化，考虑多样性、曝光公平性、商业价值等全局目标。

### 6.3.2 推荐系统的核心技术

推荐系统的核心技术包括协同过滤、内容推荐、知识图谱推荐、深度学习推荐等。

**协同过滤**是最经典的推荐方法，通过分析用户之间的行为相似性或物品之间的相似性来进行推荐。User-CF基于相似用户的行为进行推荐，Item-CF基于相似物品的行为进行推荐。协同过滤方法简单直观，但面临冷启动和稀疏性问题。

**内容推荐**基于供给的内容特征和用户的历史偏好进行推荐。这种方法能够处理新供给的冷启动问题，但容易陷入“信息茧房”，推荐结果缺乏多样性。

**知识图谱推荐**利用知识图谱中的结构化知识来增强推荐效果。知识图谱可以提供供给之间的语义关联、用户的历史偏好与供给属性之间的匹配等信息，帮助推荐系统做出更加准确和可解释的推荐。KGAT、KGIN等知识图谱注意力网络在推荐任务上取得了显著效果。

**深度学习推荐**利用深度神经网络来学习用户和供给的复杂交互模式。DeepFM、Wide & Deep、DCN等模型能够自动学习特征的高阶交互，在工业推荐系统中得到了广泛应用。

### 6.3.3 场景化推荐

场景化推荐是根据用户当前所处的场景进行上下文感知的推荐。用户的需求往往与场景密切相关，在不同的时间、地点、状态下可能需要不同的供给。

**时间场景**是影响用户需求的重要因素。例如，早餐时间用户可能需要外卖服务，通勤时间用户可能需要出行服务，晚上用户可能需要娱乐内容。时间感知的推荐能够根据当前时间推送最可能需要的供给。

**地点场景**是另一个重要的上下文因素。用户在不同地点时，附近的供给种类和可及性不同。本地化的推荐能够根据用户的地理位置推荐附近的商品和服务。

**状态场景**包括用户当前的活动状态、心情状态等。例如，用户在旅游时可能需要景点门票和酒店预订，在健身时可能需要运动装备和健康饮食。

## 6.4 双向匹配的协同机制

### 6.4.1 搜索与推荐的融合

搜索和推荐是平台提供供给匹配能力的两种基本模式，它们各有优势和适用场景。搜索适合用户有明确需求的场景，推荐适合用户没有明确需求或需要探索的场景。在实际应用中，搜索和推荐往往是相互融合、相互补充的。

**搜索结果中的推荐**是指在搜索结果页面中穿插推荐内容。例如，当用户搜索“手机”时，除了展示手机商品外，还可以推荐手机壳、充电器等配件。这种方式能够提升推荐商品的曝光机会。

**推荐结果中的搜索**是指在推荐结果中融入用户的搜索意图。例如，推荐系统可以根据用户最近的搜索词来调整推荐内容，推荐与搜索词相关的供给。

**统一召回**是搜索和推荐融合的更深层次方式。统一的召回系统可以同时为搜索和推荐提供候选集，根据用户的需求动态调整召回策略。

### 6.4.2 双向匹配的价值最大化

双向匹配的价值最大化需要考虑全局优化目标，而不仅仅是单个方向的匹配效果。

**供给曝光公平性**是双向匹配需要考虑的重要问题。一些高质量的供给可能由于缺乏曝光数据而难以获得推荐机会，形成“马太效应”。双向匹配系统需要设计合理的冷启动机制和曝光公平性策略，确保新供给和长尾供给也有机会展示给用户。

**用户体验一致性**要求搜索和推荐提供的用户体验保持一致。如果用户在搜索中看到了某类供给，但推荐中没有相关的供给，可能会造成用户体验的割裂。

**商业价值平衡**是双向匹配需要考虑的另一重要因素。平台需要在用户体验和商业变现之间取得平衡，避免过度商业化对用户体验的损害。

### 6.4.3 大语言模型在双向匹配中的应用

大语言模型的出现为双向匹配带来了新的技术可能性。LLM可以用于：

**查询理解增强**。LLM强大的语言理解能力可以用于更准确地理解用户的查询意图，生成更好的查询表示。

**供给理解增强**。LLM可以用于生成更加丰富的供给描述，提取供给的深层语义特征。

**匹配推理增强**。LLM可以直接进行零样本的匹配判断，预测用户对供给的偏好。

**生成式推荐**。基于LLM的生成式推荐可以根据用户偏好和上下文信息生成个性化的推荐理由和展示内容。

然而，LLM在匹配场景中的应用也面临着推理延迟高、计算成本大、难以处理大规模数据等挑战。实际应用中通常采用混合架构，结合小模型的效率和大模型的效果。

## 6.5 匹配效果的评测

### 6.5.1 搜索匹配的评测指标

搜索匹配的评测指标主要包括相关性指标、点击指标、转化指标等。

**相关性指标**衡量搜索结果与查询的相关程度，常用的指标包括Precision@K、Recall@K、NDCG等。NDCG（Normalized Discounted Cumulative Gain）是搜索排序评测中最常用的指标，它考虑了结果的相关性等级和位置因素。

**点击指标**通过分析用户的点击行为来评估搜索效果，常用的指标包括CTR（点击率）、UCTR（独特点击率）等。点击指标能够反映用户对搜索结果的满意度。

**转化指标**衡量搜索带来的最终转化效果，常用的指标包括CVT（转化率）、GMV（成交总额）等。转化指标是搜索效果的最终检验标准。

### 6.5.2 推荐匹配的评测指标

推荐匹配的评测指标与搜索类似，但更加强调个性化效果。

**准确率指标**衡量推荐结果的准确性，常用的指标包括Precision@K、Recall@K、F1等。

**排名指标**考虑推荐结果在列表中的位置，常用的指标包括NDCG、MRR（Mean Reciprocal Rank）等。

**多样性指标**衡量推荐结果的多样性，常用的指标包括ILS（Intra-List Similarity）、覆盖率（Coverage）等。

**商业指标**衡量推荐带来的商业价值，包括点击率、转化率、用户停留时长、用户留存率等。


> **批判性分析：** 离线评测与线上效果之间往往存在显著差距。研究表明，点击率提升不一定带来转化率提升，短期效果可能影响长期用户留存。ChatGPT推荐研究（2601.01997）发现，GPT-4在冷启动场景下表现优异，在Facebook Books上达到0.0538的nDCG，但这可能部分源于模型对训练数据的记忆（记忆率高达80.76%），而非真正的泛化能力。因此，匹配系统的优化需要综合考虑多个指标，并进行持续的线上效果监控和调优。
### 6.5.3 线上线下评测的一致性

匹配效果的评测需要结合离线评测和线上评测。离线评测通过历史数据进行模型评估，快速迭代模型；线上评测通过A/B测试验证模型的实际效果。离线评测和线上评测的一致性是模型迭代的关键挑战。

研究表明，离线评测指标与线上效果之间往往存在差距。点击率提升不一定带来转化率提升，短期效果可能影响长期用户留存。因此，匹配系统的优化需要综合考虑多个指标，并进行持续的线上效果监控和调优。

## 6.6 本章小结

本章系统性地介绍了双向匹配的技术体系。搜索匹配（人找供给）和推荐匹配（供给找人）是供给与需求匹配的两种基本模式，分别对应用户的主动搜索和平台的主动推荐。两种模式在技术框架、核心算法、评测指标等方面既有相似之处，也有各自的特点。搜索与推荐的融合、双向匹配的协同是提升匹配效果的重要方向。大语言模型的出现为双向匹配带来了新的技术可能性，但也面临着效率与效果的平衡挑战。

在后续章节中，本书将继续探讨LLM评测方法、电商评测基准、服务理解评测体系等评测相关内容。

## 本章回顾检查清单

- [ ] 搜索匹配的技术框架是否完整？
- [ ] 语义匹配技术是否充分讨论？
- [ ] 推荐匹配的技术框架是否清晰？
- [ ] 搜索与推荐的融合是否涵盖？
- [ ] 双向匹配的价值最大化是否分析？
- [ ] 是否引用了具体论文？
- [ ] 匹配效果评测指标是否全面？
- [ ] 学术论文风格是否保持一致？
- [ ] 字数是否在3000-8000字范围内？
