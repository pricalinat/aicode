# 图4.2：图神经网络用于商品表示学习

```
GraphSAGE算法流程:

┌─────────────────────────────────────────────────────────────────────┐
│ Step 1: 邻居采样                                                   │
│                                                                      │
│   商品A的邻居: [B, C, D, E]                                         │
│   采样固定数量: 假设采样2个                                         │
│   采样结果: [B, C]                                                 │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│ Step 2: 邻居聚合                                                   │
│                                                                      │
│   Mean聚合: h_{N(A)} = mean(h_B, h_C)                              │
│                                                                      │
│   Max-pool聚合: h_{N(A)} = max(ReLU(W·h_B), ReLU(W·h_C))          │
│                                                                      │
│   LSTM聚合: 按随机顺序排列邻居，用LSTM聚合                          │
└─────────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────────┐
│ Step 3: 特征更新                                                   │
│                                                                      │
│   h_A^{new} = σ(W · CONCAT(h_A^{old}, h_{N(A)}))                  │
│                                                                      │
│   示例:                                                             │
│   h_A^{old} = [0.1, 0.2, 0.3]                                     │
│   h_{N(A)}  = [0.2, 0.1, 0.2]                                     │
│   CONCAT   = [0.1, 0.2, 0.3, 0.2, 0.1, 0.2]                      │
│   h_A^{new} = σ(W · CONCAT) → [0.8, 0.6, 0.7]                    │
└─────────────────────────────────────────────────────────────────────┘

商品图结构示例:
┌─────────────────────────────────────────────────────────────────────┐
│                                                                      │
│      [iPhone15]──────has_brand─────>[苹果]                         │
│         │                                   │                        │
│    similar_to                         belongs_to                    │
│         ↓                                   ↓                       │
│    [三星S23]──────────────────────>[智能手机]                       │
│         │                                   │                        │
│    complementary_to                  belongs_to                    │
│         ↓                                   ↓                       │
│    [手机壳]─────────────────────────>[数码产品]                      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```
